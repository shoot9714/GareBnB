<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "report">

<!-- 신고내역보기 (일반 회원)- MEM_ID 세션에서 -->
<select id="selectOneReportList" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT
		REPORT_IDX,
		REPORT_TITLE,
		REPORT_ID,
		REPORT_CONTENT,
		REPORT_DATE,
		REPORT_STATE,
		REPORT_COMMENT,
		REPORT_MEM_IDX,
		REPORT_RES_NO
	FROM 
		REPORT
	WHERE 
		REPORT_ID = #{MEM_ID}
]]>
</select>



<!-- 신고내용 입력 -일반회원인경우 -->
<insert id = "insertReport" parameterType="hashmap">

<selectKey keyProperty="RES_MEM_IDX" resultType="string" order="BEFORE">
			SELECT RES_HOST_ID FROM RESERVATION
			WHERE RES_IDX = #{RES_IDX}
	</selectKey>


<!-- 예약번호 -->	
<selectKey keyProperty="REPORT_RES_NO" resultType="string" order="BEFORE">
			SELECT RES_IDX FROM RESERVATION
			WHERE 
	</selectKey>
	
	<![CDATA[
		INSERT INTO REPORT
			(
				REPORT_IDX,
				REPORT_TITLE,
				REPORT_ID,
				REPORT_CONTENT,
				REPORT_DATE,
				REPORT_STATE,
				REPORT_MEM_IDX,
       		    REPORT_RES_NO
			)
			VALUES
			(
				REPORT_IDX_SEQ.NEXTVAL, 
				#{REPORT_TITLE}, 
				#{REPORT_ID},
				#{REPORT_CONTENT},
				SYSDATE,
			 	'0',
				#{REPORT_MEM_IDX}
				#{REPORT_RES_NO}
			)
		]]>
</insert>

<!-- 	<selectKey keyProperty="REPORT_MEM_IDX,RES_NO" resultType="string" order="BEFORE">
	신고할 HOST의 ID와 RES_NO를 찾는거니깐 게시글 번호 
			SELECT A.RES_HOST_ID, A.RES_IDX
			FROM RESERVATION R INNER JOIN BOARD B
			ON 	R.RES_BOARD_NO=B.BOARD_NO
       	     		WHERE R.RES_CLI_ID= #{MEM_ID}
	</selectKey> -->

<!-- 신고내용 리스트보기 -->
	<select id="selectReportList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				REPORT_IDX,
				REPORT_TITLE,
				REPORT_CONTENT,
				REPORT_DATE,
				REPORT_STATE,
				REPORT_COMMENT,
			FROM
				REPORT
			WHERE
				REPORT_ID = #{MEM_ID}		
		]]>
	</select>





<!-- 신고내용 리스트보기 관리자 -->
<select id ="selectAdminReportList" parameterType ="hashmap" resultType="hashmap">
		SELECT
			REPORT_IDX, REPORT_TITLE, REPORT_ID, REPORT_DATE
		FROM
			REPORT
		ORDER BY REPORT_DATE DESC		
</select>



<!-- 신고 내용 상세보기 관리자 -->   
<select id ="selectAdminOneReport" parameterType ="hashmap" resultType = "hashmap">
		SELECT
			REPORT_IDX,
			REPORT_TITLE,
			REPORT_ID,
			REPORT_DATE,
			REPORT_CONTENT,
			REPORT_STATE,
			REPORT_COMMENT,
			REPORT_MEM_IDX,
			REPORT_RES_NO
		FROM
			REPORT
		WHERE
			REPORT_IDX = #{REPORT_IDX}
</select>


<!-- 신고 답변 작성 관리자 --> 
<update id ="updateReportComment" parameterType ="hashmap">
	<![CDATA[
		UPDATE 
			REPORT
		SET
			REPORT_STATE = '1',
			REPORT_COMMENT = #{REPORT_COMMENT}
		WHERE 
			REPORT_IDX = #{REPORT_IDX}
	]]>
</update>

</mapper>